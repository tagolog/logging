declare @messageId uniqueidentifier
set @messageId = newid()

insert into Log.Message(
    CustomerId,
    ApplicationId,
	MessageId,
    LevelId,
    Created,
    Logged,
	CreatedTicks,
    CorrelationId,
	LogUserIdentity,
    LogIPAddress,
    RequestIPAddress,
    MessageText,
    ExceptionText,
    PacketLength,
	SphinxTagsText )
  select
    @customerId as CustomerId,
    @applicationId as ApplicationId,
	@messageId as MessageId,
    @logLevelId as LevelId,
    @created as Created,
    @logged as Logged,
	@createdTicks as CreatedTicks,
    @correlationId as CorrelationId,
	@logUserIdentity as LogUserIdentity,
    @logIPAddress as LogIPAddress,
    @requestIPAddress as RequestIPAddress,
    @messageText as MessageText,
    @exceptionText as ExceptionText,
    @packetLength as PacketLength,
	@SphinxTagsText as SphinxTagsText

insert into Log.MessageTag
(
  MessageId,
  TagId,
  CustomerId,
  TagValue
)
select
    @messageId as MessageId,
    tag.Id as TagId,
    @customerId as CustomerId,
    tag.Value as TagValue
  from
  (
    select
        dbTag.TagId as Id,
        logEntryTag.Value as Value
      from Log.Tag as dbTag
      join
      (
        {logEntryTags_UnionAll}
      ) as logEntryTag
      on
        dbTag.Code = logEntryTag.Code
      where
        dbTag.CustomerId = @customerId
  ) as tag
